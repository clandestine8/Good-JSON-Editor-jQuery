!function(e){e.fn.childrenWithData=function(t){return this.children().filter(function(){return"undefined"!=typeof e(this).data(t)})},e.fn.siblingWithData=function(t){return this.siblings().filter(function(){return"undefined"!=typeof e(this).data(t)})},e.fn.equals=function(t){return e(this)[0]===e(t)[0]},e.fn.enterKey=function(t){return this.each(function(){e(this).keypress(function(e){var n=e.keyCode?e.keyCode:e.which;e.shiftKey||"13"!=n&&"10"!=n||t.call(this,e)})})},e.strReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)};var t=function(t,n,a){if(""===a)return t;n.indent._count>n.indent.count&&t.addClass(n.elements[n.indent.class]),t.attr("data-field",a),t.attr("draggable",!0);var i=e("<span />");i.html(a+""),i.addClass(n.elements.field),i.addClass(n.elements.edit),i.attr("draggable",!0),t.prepend(i);var r=e("<span>"+n.icons[t.attr("data-type")]+"</span>");r.addClass(n.iconClass),r.addClass(n.elements.type),r.attr("draggable",!0),t.prepend(r);var o=e("<span>"+n.icons.delete+"</span>");o.addClass(n.iconClass),o.css("float","right"),o.attr("draggable",!0),t.prepend(o);var s=e("<span>"+n.icons.move+"</span>");return s.addClass(n.iconClass),s.addClass(n.icons.move),t.prepend(s),t},n=function(t,n){var a=Object.prototype.toString.call(n),i=e("<div />");return a in r||(a="[object Null]"),i.attr("data-type",a),r[a].parse.apply(i,[t,n])},a={objectify:function(t,n,a){return e.each(t.childrenWithData("type"),function(t,i){n[e(i).attr("data-field")]=d.objectify.apply(i,[a])}),n},_addValToParent:function(e,a,i,r){var o=n.apply(this,[a,r]);return o.attr("data-indent-count",a.indent._count),o.addClass(a.elements.indent),o=t(o,a,i),o.children("."+a.elements.field).attr("tabindex",0),o.children("."+a.elements.value).attr("tabindex",0),e.append(o),o},parse:function(t,n,i,r){n.indent._count++,e.each(i,function(e,i){a._addValToParent.apply(this,[t,n,e,i])}),n.indent._count--,t.addClass(r),t.attr("data-more",!0);var o=e("<span>"+n.icons.less+"</span>");o.addClass(n.iconClass),o.css("float","right"),t.prepend(o);var s=e("<span>"+n.icons.add+"</span>");return s.addClass(n.iconClass),s.css("float","right"),t.prepend(s),t}},i={objectify:function(e,t){return e.children("."+t.elements.value).html()},parse:function(t,n,a,i){var r=e("<span />");return r.html(a),r.addClass(n.elements.value),r.addClass(n.elements.edit),r.attr("draggable",!0),t.append(r),t.addClass(i),t}},r={"[object Array]":{objectify:function(t){return a.objectify(e(this),[],t)},parse:function(t,n){var i=a.parse(e(this),t,n,t.elements.array);return i.attr("data-length",n.length),i},change:function(t,n,a){if("[object Object]"===a){var i=[];return e.each(n,function(e,t){i.push(t)}),i}return[]}},"[object Object]":{objectify:function(t){return a.objectify(e(this),{},t)},parse:function(t,n){return a.parse(e(this),t,n,t.elements.object)},change:function(t,n,a){if("[object Array]"===a){var i={};return e.each(n,function(e,t){i[e]=t}),i}return{}}},"[object String]":{objectify:function(t){return e(this).children("."+t.elements.value).html().replace(/<br>/g,"\n")},parse:function(t,n){return i.parse(e(this),t,n.replace(/\r\n/g,"\n").replace(/\n/g,"<br>"),t.elements.string)},change:function(e,t,n){var a=t+"";return""===a&&(a="new string"),a}},"[object Number]":{objectify:function(t){return parseInt(i.objectify(e(this),t))},parse:function(t,n){return i.parse(e(this),t,n,t.elements.number)},change:function(t,n,a){if("[object String]"===Object.prototype.toString.call(n)&&n.includes("<span")&&(n=e(n).text()),"[object Boolean]"===a)return n?1:0;var i=parseInt(n,t);return isNaN(i)?0:i}},"[object Boolean]":{objectify:function(t){return r["[object Boolean]"].change(t,i.objectify(e(this),t)+"")},parse:function(t,n){return i.parse(e(this),t,r["[object Boolean]"].change(t,n)?"true":"false",t.elements.bool)},change:function(t,n,a){return"[object String]"===Object.prototype.toString.call(n)&&n.includes("<span")&&(n=e(n).text()),n===!0||"true"===n||"1"===n||1===n}},"[object Null]":{objectify:function(e){return null},parse:function(t,n){return i.parse(e(this),t,"null",t.elements.null)},change:function(e,t){return null}}},o={_add:function(e){if(e._history.cur++,e._history.list.length>e._history.cur){for(var t=e._history.cur;t<e.historySize;t++)delete e._history.list[t];var n=[];e._history.list.forEach(function(e){n.push(e)}),e._history.list=n}e._history.list.push(e._base.html()),e._history.cur>=e.historySize&&(e._history.cur--,e._history.list.shift())},_back:function(e){e._history.cur>0&&(e._history.cur--,e._base.html(e._history.list[e._history.cur]))},_next:function(e){e._history.cur<e.historySize&&(e._history.cur++,e._base.html(e._history.list[e._history.cur]))}},s=function(t){var n={},a={},i={};return e.each(t.elements,function(t,a){n[t]=a+""+e.fn.goodJSON._cssCount}),e.each(t.classes,function(i,r){e.each(t.elements,function(t,a){i=e.strReplaceAll(i,a,n[t])}),a[i]=r}),e.each(t.on,function(t,n){i[t]={},e.each(n,function(n,a){"buttons"!==n&&(n=n+""+e.fn.goodJSON._cssCount),i[t][n]=a})}),t.elements=n,t.classes=a,t.on=i,e.fn.goodJSON._cssCount++,t},c=function(t){var n=function(){var e=document.createElement("canvas");e.width=t.iconSize,e.height=t.iconSize;var n=e.getContext("2d");return n.fillStyle="#000000",n.font="24px '"+t.iconFont+"'",n.textAlign="center",n.textBaseline="middle",n.fillText("mode_edit",.5*t.iconSize,.5*t.iconSize),n.fillStyle="#FFFFFF",n.font="22px '"+t.iconFont+"'",n.textAlign="center",n.textBaseline="middle",n.fillText(t.icons.edit,.5*(t.iconSize-1),.5*(t.iconSize-1)),e.toDataURL("image/png")},a=e("head");a.append(t.iconCss);var i=e("<span />");i.css("visibility","hidden"),i.addClass(t.iconClass),i.text(t.icons.edit),e("body").append(i);var r=function(){t.classes["."+t.elements.edit]=t.classes["."+t.elements.edit].replace("[rp]",n());var r=e("<style />");e.each(t.classes,function(e,t){r.append(""+e+" { "+t+" } ")}),a.append(r),i.remove()},o=function(){i.width()==t.iconSize?r():setTimeout(o,300)};t=s(t),setTimeout(o,300)},l=function(t,n){function a(n){t._base.off(n),t._base.on(n,function(a){"click"===n&&void 0!==t._typePicker&&t._typePicker.Remove();var i=e(a.target);if(i.is("span")&&i.hasClass(t.iconClass)){var r=i.text();return void 0!==t.on[n].buttons&&r in t.on[n].buttons?(o._add(t),t.on[n].buttons[r].apply(i,[t,a])):(a.preventBubble&&a.preventBubble(),a.stopPropagation&&a.stopPropagation(),!1)}var s=i.attr("class");void 0!==s&&e.each(s.split(/\s+/),function(e,r){r===t.elements.field&&"root"===i.text()||i.hasClass(t.elements.value)&&i.parent().hasClass(t.elements.null)||i.parent().parent().hasClass(t.elements.array)&&i.hasClass(t.elements.field)||r in t.on[n]&&(o._add(t),t.on[n][r].apply(i,[t,a]))})})}return t._base=this,this.data("settings",t),c(t),d.parse.apply(t._base,[t,n]),e.each(t.on,function(e,t){a(e)}),t._base},d={parse:function(t,a){"[object Array]"!==Object.prototype.toString.call(a)&&"[object Object]"!==Object.prototype.toString.call(a)&&(a=jQuery.parseJSON(a));var i=n.apply(this,[t,a]);this.html(i.html());var r=e("<span>"+t.icons[i.attr("data-type")]+"</span>");return r.addClass(t.elements.type),r.addClass(t.iconClass),this.prepend(r),this.attr("data-more",!0),this.attr("data-type",i.attr("data-type")),this.attr("class",i.attr("class")),this.addClass(t.elements.base),o._add(t),t._base},stringify:function(e){return JSON.stringify(d.objectify.apply(this,[e]),e.replace,e.space)},objectify:function(t){var n=e(this).attr("data-type");return n in r||(n="[object Null]"),r[n].objectify.apply(this,[t])},undo:function(e){return o._back(e),e._base},redo:function(e){return o._next(e),e._base},settings:function(e){return this.data("settings",e),this}};e.fn.goodJSON=function(t,n,a){var i,r=e(this),o=!1;return void 0!==r.data("settings")&&(i=e.extend({},r.data("settings")),o=!0),o?"parse"===t?(void 0!==a&&(i=e.extend(i,a)),d.parse.apply(r,[i,n])):(void 0!==n&&(i=e.extend(i,n)),void 0===t?d.stringify.apply(r,[i]):t in d?d[t].apply(r,[i,n]):(void 0!==t&&"[object Object]"===Object.prototype.toString.call(t)&&(i=e.extend(i,t)),d.stringify.apply(r,[i]))):void 0===n&&void 0===t?l.apply(r,[e.fn.goodJSON.defaultSettings,{}]):void 0===n?l.apply(r,[e.fn.goodJSON.defaultSettings,t]):l.apply(r,[e.extend({},e.fn.goodJSON.defaultSettings,n),t])},e.fn.goodJSON._cssCount=0,e.fn.goodJSON.defaultSettings={_base:null,_tabIndex:0,_typePicker:void 0,historySize:10,_isDragging:!1,_history:{cur:-1,list:[]},space:null,replace:null,indent:{_count:0,count:8,class:"invert"},tabSize:5,iconCss:'<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">',iconSize:24,iconClass:"material-icons",iconFont:"Material Icons",acceptedType:{"[object String]":{edit:function(t,n){var a=e('<textarea draggable="true" rows="'+n.split(/<br>/).length+'">'+n.replace(/<br>/g,"\n")+"</textarea>");return a.keypress(function(e){a.attr("rows",a.val().split(/\n/).length)}),a},value:function(e){return e.inputActive.val().replace(/\r\n/g,"\n").replace(/\n/g,"<br>")},defaultValue:" "},"[object Number]":{edit:function(t,n){return e('<input draggable="true" type="number" step="any" value="'+n+'" />')},validate:function(e){return!isNaN(parseInt(e.inputActive.val()))},value:function(e){return e.inputActive.val()},defaultValue:0},"[object Boolean]":{edit:function(t,n){return e('<span draggable="true">'+("true"===n?"false":"true")+"</span>").click(function(t){e(this).parent().click()})},value:function(e){return e.inputActive.text()}}},icons:{edit:"mode_edit",delete:"delete_forever",add:"note_add",less:"expand_less",more:"expand_more",move:"reorder","[object Object]":"{}","[object Array]":"[]","[object String]":'""',"[object Number]":"0.0","[object Boolean]":"*","[object Null]":"--"},elements:{field:"json-field",object:"json-object",array:"json-array",indent:"json-indent",null:"json-null",bool:"json-bool",number:"json-number",string:"json-string",value:"json-value",type:"json-type",edit:"json-edit",base:"good-json",pick:"json-pick",choose:"json-choose",target:"drag-over",invert:"json-brightText"},classes:{".material-icons":"cursor:pointer; height:15px;width:15px;font-size: 15px;",".json-type":"margin-right:5px; margin-left:5px; font-family: 'Custom Icons';text-align: center;font-size: 12px;font-style: italic;",".json-indent":"margin: 2px 0 0 10px;-moz-user-select: none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;/* Required to make elements draggable in old WebKit */-khtml-user-drag: element;-webkit-user-drag: element;",".json-brightText":"color:white;",".good-json div.json-brightText":"box-shadow: 0px 1px 1px 0px rgba(255, 255, 255, 0.16);",".json-field":"display: inline-block; margin-right: 5px;margin-bottom: 5px;font-size:0.75rem;font-family:'Lucida Console', Monaco, monospace;width:calc(100% - 60px);",".json-array > .json-field, .json-object > .json-field, .json-field input":"width:calc(100% - 90px);",".json-object":"",".json-array":"",".drag-over":"border: 2px dashed #000;",".json-null span.json-value":"",".json-array > .json-indent > .json-field":"display:none;",".json-edit":"cursor: url([rp]), auto",".json-null > .json-value, .json-value.json-edit div, article":"cursor: default;",".good-json, .good-json div":"padding: 5px 5px 5px 5px; box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.16); background-color: rgba(0, 0, 0, 0.1);",".good-json > span":"transition: visibility 0s, opacity 0.5s linear;",".json-value textarea, .json-value input":"font-family: 'Roboto', sans-serif;font-size: 16px;width:98%",".json-field input":"font-size:0.75rem;font-family:'Lucida Console';",".reorder":"cursor: move;",".json-pick":"cursor:pointer; ",".json-pick:hover":"color:#f0f0f0;",".json-choose":"position: absolute; background: #bcbcbc;"},save_current_edit:function(e){if(void 0!==e.inputActive){var t=e.inputActive.parent();if("true"===e.inputActive.attr("data-is-field"))t.parent().attr("data-field",e.inputActive.val()),t.html(e.inputActive.val());else{var n=t.parent().attr("data-type");if(n in e.acceptedType)if(void 0!==e.acceptedType[n].validate)if(e.acceptedType[n].validate(e))e.inputActive.parent().html(e.acceptedType[n].value(e));else{var a=e.inputActive.attr("data-original");""!==a&&void 0!==a||void 0===e.acceptedType[n].defaultValue||(a=e.acceptedType[n].defaultValue),e.inputActive.parent().html(a)}else e.inputActive.parent().html(e.acceptedType[n].value(e));e.inputActive=void 0}}},open_new_edit:function(t){t.save_current_edit(t);var n=this.parent().attr("data-type");this.hasClass(t.elements.field)?t.inputActive=e('<input draggable="false" type="text" value="'+this.text()+'" />'):n in t.acceptedType&&(t.inputActive=t.acceptedType[this.parent().attr("data-type")].edit(t,this.html())),t.inputActive.attr("data-is-field",this.hasClass(t.elements.field)?"true":"false"),t.inputActive.attr("data-original",this.html()),t.inputActive.enterKey(function(){t.save_current_edit(t)}),t.inputActive.focusout(function(e){t.save_current_edit(t)}),t.inputActive.blur(function(e){t.save_current_edit(t)}),t.inputActive.enterKey(function(){t.save_current_edit(t)}),this.html(""),this.append(t.inputActive),t.inputActive.width(this.parent().width()-100),t.inputActive.focus()},move_value:function(t,a,i){var r,o=a.parent(),s=i.parent(),c=o.attr("data-type"),l=s.attr("data-type"),u=a.attr("data-field"),p=i.attr("data-field"),f=d.objectify.apply(a,[t]);a.remove();var h=d.objectify.apply(s,[t]);if("[object Array]"===l?(u=parseInt(i.attr("data-field")),r=[]):("[object Array]"===c&&(u="New Field "+Math.random()),r={}),s.equals(o))if("[object Array]"===l){var g=parseInt(a.attr("data-field"));e.each(h,function(e,t){u===e&&r.push(f),e!==g&&r.push(t)})}else e.each(h,function(e,t){u!==e&&(p===e&&(r[u]=f),r[e]=t)});else"[object Array]"===l?e.each(h,function(e,t){u===e&&r.push(f),r.push(t)}):e.each(h,function(e,t){p===e&&(r[u]=f),r[e]=t});s.children("div").remove();var y=n.apply(s,[t,r]).children("div");if(e.each(y,function(t,n){s.append(e(n))}),"[object Array]"===c){var v=0;e.each(o.children("div"),function(n,a){e(a).attr("data-field",v++),e(a).children("."+t.elements.field).first().text(v+"")})}},open_change_field:function(t,n){n.fadeTo(200,.4),t._typePicker=e("<div />"),t._typePicker.Remove=function(){n.fadeTo(200,1),t._typePicker.remove(),t._typePicker=void 0},t._typePicker.addClass(t.elements.base),t._typePicker.addClass(t.elements.choose),t._typePicker.css({top:this.position().top+20,left:this.position().left,position:"absolute"}),e.each(r,function(a){if(!n.equals(t._base)||"[object Object]"===a||"[object Array]"===a){var i=e("<div>"+t.icons[a]+" - Change to "+a+"</div>");i.attr("data-type",a),i.addClass(t.elements.pick),i.addClass(t.elements.indent),t._typePicker.append(i)}}),t._typePicker.click(function(a){var i=e(a.target).attr("data-type"),r=n.attr("data-type");void 0!==i&&(r!==i&&t.change_type(t,n,i,r),n.fadeTo(400,1),t._typePicker.Remove())}),e("body").append(t._typePicker)},change_type:function(a,i,o,s){var c,l=d.objectify.apply(i,[a]);if(i.equals(a._base))return"[object Array]"===o?(c=[],e.each(l,function(e,t){c.push(t)})):(c={},e.each(l,function(e,t){c[e]=t})),i.goodJSON("parse",c,a);c=r[o].change(a,l,s);var u=t(n(a,c),a,i.attr("data-field"));i.hasClass(a.elements.indent),u.addClass(a.elements.indent),u.insertBefore(i),i.remove()},on:{keypress:{"json-edit":function(e,t){var n=t.keyCode?t.keyCode:t.which;"13"==n||"10"==n?e.open_new_edit.apply(this,[e]):(this.text(""),e.open_new_edit.apply(this,[e]))}},mousedown:{buttons:{reorder:function(e,t){e._isDragging=!0}}},mouseup:{buttons:{reorder:function(e,t){e._isDragging=!1}}},dragstart:{"json-indent":function(e,t){return e._isDragging?(this.fadeTo(0,.4),void(e._currentDraggedSource=this)):(t.preventBubble&&t.preventBubble(),t.stopPropagation&&t.stopPropagation(),!1)}},dragenter:{"json-edit":function(e,t){return e.on.dragenter[e.elements.indent].apply(this.parent(),[e,t])},"json-indent":function(e,t){return!(!e._isDragging||jQuery.inArray(e._currentDraggedSource[0],t.originalEvent.path)>=0||e._currentDraggedSource.equals(this))&&(void 0!==e._currentDraggedTarget&&e._currentDraggedTarget.removeClass(e.elements.target),this.addClass(e.elements.target),void(e._currentDraggedTarget=this))}},dragleave:{"json-indent":function(e,t){return!(!e._isDragging||void 0!==e._currentDraggedTarget||jQuery.inArray(e._currentDraggedSource[0],t.originalEvent.path)>=0)&&(e._currentDraggedTarget.removeClass(e.elements.target),void(e._currentDraggedTarget=void 0))}},dragend:{"json-indent":function(e,t){return void 0!==e._currentDraggedSource&&e._currentDraggedSource.fadeTo(0,1),void 0!==e._currentDraggedTarget&&e._currentDraggedTarget.removeClass(e.elements.target),!(!e._isDragging||jQuery.inArray(e._currentDraggedSource[0],t.originalEvent.path)>0||void 0===e._currentDraggedTarget)&&(e.move_value(e,e._currentDraggedSource,e._currentDraggedTarget),e._isDragging=!1,e._currentDraggedTarget=void 0,void(e._currentDraggedSource=void 0))}},click:{buttons:{"{}":function(e){e.open_change_field.apply(this,[e,this.parent()])},"[]":function(e){e.open_change_field.apply(this,[e,this.parent()])},'""':function(e){e.open_change_field.apply(this,[e,this.parent()])},"0.0":function(e){e.open_change_field.apply(this,[e,this.parent()])},"*":function(e){e.open_change_field.apply(this,[e,this.parent()])},"--":function(e){e.open_change_field.apply(this,[e,this.parent()])},expand_more:function(e,t){t||this.text(e.icons.less),this.parent().attr("data-more",!0),this.siblings("div").slideToggle("fast")},expand_less:function(e){this.text(e.icons.more),this.parent().attr("data-more",!1),this.siblings("div").slideToggle("fast")},delete_forever:function(e){this.parent().remove()},note_add:function(e){var t=this.parent(),n=t.attr("data-type");e.indent._count=parseInt(t.attr("data-indent-count"))+1;var i,r="true"===t.attr("data-more");if("[object Object]"===n&&(i=a._addValToParent.apply(t,[t,e,"New Field "+Math.random(),null])),"[object Array]"===n){var o;t.attr("data-length",(o=parseInt(t.attr("data-length")))+1),i=a._addValToParent.apply(t,[t,e,o,null])}r||void 0===i||i.slideToggle(0)}},"json-edit":function(e){e.open_new_edit.apply(this,[e])}}}}}(jQuery);